<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Git for Humans: Patching Your Commits - Elben Shira</title>
        <script>
          function getCookie(cname) {
              var name = cname + "=";
              var ca = document.cookie.split(';');
              for(var i=0; i<ca.length; i++) {
                  var c = ca[i];
                  while (c.charAt(0)==' ') c = c.substring(1);
                  if (c.indexOf(name) == 0) return c.substring(name.length,c.length);
              }
              return "";
          }

          // If cookie set, assume font is cached, so load right away. May get
          // cache miss sometimes (esp w/ GitHub pages 10 min cache), but that's OK.
          if(getCookie("fonts-loaded") == "true") {
              document.documentElement.className += " fonts-loaded";
          }

          if(getCookie("code-fonts-loaded") == "true") {
              document.documentElement.className += " code-fonts-loaded";
          }

          window.addEventListener("load", function() {
            var elems = document.getElementsByClassName("view-comments");
            for (var i = 0; i < elems.length; ++i) {
              elems[i].onclick =
                function () {
                  var disqus = document.getElementById("disqus-comments");
                  if (disqus) {
                    disqus.classList.remove("hide");
                    this.classList.add("hide");
                  }
                }
            }
          });
        </script>

        <link rel="stylesheet" type="text/css" href="/stylesheets/default.css" />
    </head>
    <body>
      <div id="structure">
        <div id="header">
          <h1 itemprop="name"><a href="/">Elben Shira</a></h1>
          <span id="navigation">
            <a href="/blog/">Blog</a>
            <a href="/projects/">Projects</a>
          </span>
          <hr>
        </div>

        <div id="content">
          <article class="post-content">
  <header class="post-header">
    <h1 class="post-title">Git for Humans: Patching Your Commits</h1>

    <div class="post-metadata">
      <div class="date">
        November 21, 2011
         / <a href="/blog/tags/git/">git</a> 
      </div>
    </div>
  </header>

  
<p>Ideally, every git commit would contain one logical work. But we don’t work this way. We often get side-tracked from our current task. In the middle of a bug fix, we may see a method vulnerable for refactoring. So we refactor it.</p>
<p>And now we have to commit a bug fix and a method refactor, and they’re both in the same file. The lazy way out would be to commit the file with a nice message: “fixed bug #183 and refactored method_name”.</p>
<p>But can we do better? Yes. With the <code>--patch</code> option, we can precisely choose which hunks of code we want to add into the staging environment:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1">$ <span class="fu">git</span> add -p</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="fu">diff</span> --git a/README b/README</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="ex">index</span> 9938af1..88f41c4 100644</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="ex">---</span> a/README</a>
<a class="sourceLine" id="cb1-5" title="5"><span class="ex">+++</span> b/README</a>
<a class="sourceLine" id="cb1-6" title="6"><span class="ex">@@</span> -1,3 +1,4 @@</a>
<a class="sourceLine" id="cb1-7" title="7"><span class="ex">+Version</span> 1.2</a>
<a class="sourceLine" id="cb1-8" title="8"><span class="ex">-Version</span> 1.1</a>
<a class="sourceLine" id="cb1-9" title="9"><span class="ex">Stage</span> this hunk [y,n,q,a,d,/,e,?]? </a></code></pre></div>
<p>Not surprisingly, the <code>--patch</code> option works for other git commands like git-checkout, which would allow us to precisely choose which hunks of code we want to discard from our working directory. So use <code>--patch</code> and make your commits precise.</p>
<h3 id="archived-comments-imported-from-posterous">Archived comments; imported from Posterous</h3>
<p>2143 views and 4 responses</p>
<p>Dec 23 2010, 8:45 AM</p>
<p>vipaca responded:</p>
<p>I’ve found this mechanism useful as you say in terms of committing logical units of work, but like most things in git it can be risky. That is when committing partial change sets of the working local copy you could be committing incomplete or broken versions to the repository, an undesirable side effect.</p>
<p>Dec 23 2010, 9:09 AM</p>
<p>Elben Shira responded:</p>
<p>I think it’s fine to commit non-working code. And I think it’s fine to push non-working code to a remote repository, as long as it’s not the production branch.</p>
<p>If you wait until everything works, then why are you using version control?</p>
<p>Dec 23 2010, 1:03 PM</p>
<p>vipaca responded:</p>
<p>One of the principle reasons for using version control is to facilitate simultaneous development on a single project. Alleviating the headache associated with version tracking and file synchronization. However if you are committing broken code then your throwing a lock back in the scenario and blocking development for others. Not a productive approach to software development.</p>
<p>Dec 23 2010, 1:54 PM</p>
<p>Elben Shira responded:</p>
<p>I agree. I think all code that is committed to the remote repository and visible to others should pass all tests and not be broken. But I think it is OK to make local (and remote, as long as its your own personal remote branch) commits. ’</p>
</article>

<div class="post-content-end">
  <hr>

  <div class="view-comments">
    <a>View comments</a>
  </div>

  <div id="disqus-comments" class="hide">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname = 'elbenshira';
      var disqus_category_id = '2658740'; // "Blog" category.

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
         var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
         dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
         (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
       })();
    </script>
    <noscript>Enable JavaScript to view Disqus comments.</noscript>
  </div>

</div>

        </div>
      </div>

      <script>
        /* Font Face Observer v2.0.13 - © Bram Stein. License: BSD-3-Clause https://raw.githubusercontent.com/bramstein/fontfaceobserver */
        (function(){'use strict';var f,g=[];function l(a){g.push(a);1==g.length&&f()}function m(){for(;g.length;)g[0](),g.shift()}f=function(){setTimeout(m)};function n(a){this.a=p;this.b=void 0;this.f=[];var b=this;try{a(function(a){q(b,a)},function(a){r(b,a)})}catch(c){r(b,c)}}var p=2;function t(a){return new n(function(b,c){c(a)})}function u(a){return new n(function(b){b(a)})}function q(a,b){if(a.a==p){if(b==a)throw new TypeError;var c=!1;try{var d=b&&b.then;if(null!=b&&"object"==typeof b&&"function"==typeof d){d.call(b,function(b){c||q(a,b);c=!0},function(b){c||r(a,b);c=!0});return}}catch(e){c||r(a,e);return}a.a=0;a.b=b;v(a)}}
function r(a,b){if(a.a==p){if(b==a)throw new TypeError;a.a=1;a.b=b;v(a)}}function v(a){l(function(){if(a.a!=p)for(;a.f.length;){var b=a.f.shift(),c=b[0],d=b[1],e=b[2],b=b[3];try{0==a.a?"function"==typeof c?e(c.call(void 0,a.b)):e(a.b):1==a.a&&("function"==typeof d?e(d.call(void 0,a.b)):b(a.b))}catch(h){b(h)}}})}n.prototype.g=function(a){return this.c(void 0,a)};n.prototype.c=function(a,b){var c=this;return new n(function(d,e){c.f.push([a,b,d,e]);v(c)})};
function w(a){return new n(function(b,c){function d(c){return function(d){h[c]=d;e+=1;e==a.length&&b(h)}}var e=0,h=[];0==a.length&&b(h);for(var k=0;k<a.length;k+=1)u(a[k]).c(d(k),c)})}function x(a){return new n(function(b,c){for(var d=0;d<a.length;d+=1)u(a[d]).c(b,c)})};window.Promise||(window.Promise=n,window.Promise.resolve=u,window.Promise.reject=t,window.Promise.race=x,window.Promise.all=w,window.Promise.prototype.then=n.prototype.c,window.Promise.prototype["catch"]=n.prototype.g);}());

             (function(){function l(a,b){document.addEventListener?a.addEventListener("scroll",b,!1):a.attachEvent("scroll",b)}function m(a){document.body?a():document.addEventListener?document.addEventListener("DOMContentLoaded",function c(){document.removeEventListener("DOMContentLoaded",c);a()}):document.attachEvent("onreadystatechange",function k(){if("interactive"==document.readyState||"complete"==document.readyState)document.detachEvent("onreadystatechange",k),a()})};function r(a){this.a=document.createElement("div");this.a.setAttribute("aria-hidden","true");this.a.appendChild(document.createTextNode(a));this.b=document.createElement("span");this.c=document.createElement("span");this.h=document.createElement("span");this.f=document.createElement("span");this.g=-1;this.b.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;";this.c.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;";
             this.f.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;";this.h.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;";this.b.appendChild(this.h);this.c.appendChild(this.f);this.a.appendChild(this.b);this.a.appendChild(this.c)}
             function t(a,b){a.a.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;white-space:nowrap;font-synthesis:none;font:"+b+";"}function y(a){var b=a.a.offsetWidth,c=b+100;a.f.style.width=c+"px";a.c.scrollLeft=c;a.b.scrollLeft=a.b.scrollWidth+100;return a.g!==b?(a.g=b,!0):!1}function z(a,b){function c(){var a=k;y(a)&&a.a.parentNode&&b(a.g)}var k=a;l(a.b,c);l(a.c,c);y(a)};function A(a,b){var c=b||{};this.family=a;this.style=c.style||"normal";this.weight=c.weight||"normal";this.stretch=c.stretch||"normal"}var B=null,C=null,E=null,F=null;function G(){if(null===C)if(J()&&/Apple/.test(window.navigator.vendor)){var a=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))(?:\.([0-9]+))/.exec(window.navigator.userAgent);C=!!a&&603>parseInt(a[1],10)}else C=!1;return C}function J(){null===F&&(F=!!document.fonts);return F}
function K(){if(null===E){var a=document.createElement("div");try{a.style.font="condensed 100px sans-serif"}catch(b){}E=""!==a.style.font}return E}function L(a,b){return[a.style,a.weight,K()?a.stretch:"","100px",b].join(" ")}
A.prototype.load=function(a,b){var c=this,k=a||"BESbswy",q=0,D=b||3E3,H=(new Date).getTime();return new Promise(function(a,b){if(J()&&!G()){var M=new Promise(function(a,b){function e(){(new Date).getTime()-H>=D?b():document.fonts.load(L(c,'"'+c.family+'"'),k).then(function(c){1<=c.length?a():setTimeout(e,25)},function(){b()})}e()}),N=new Promise(function(a,c){q=setTimeout(c,D)});Promise.race([N,M]).then(function(){clearTimeout(q);a(c)},function(){b(c)})}else m(function(){function u(){var b;if(b=-1!=
  f&&-1!=g||-1!=f&&-1!=h||-1!=g&&-1!=h)(b=f!=g&&f!=h&&g!=h)||(null===B&&(b=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),B=!!b&&(536>parseInt(b[1],10)||536===parseInt(b[1],10)&&11>=parseInt(b[2],10))),b=B&&(f==v&&g==v&&h==v||f==w&&g==w&&h==w||f==x&&g==x&&h==x)),b=!b;b&&(d.parentNode&&d.parentNode.removeChild(d),clearTimeout(q),a(c))}function I(){if((new Date).getTime()-H>=D)d.parentNode&&d.parentNode.removeChild(d),b(c);else{var a=document.hidden;if(!0===a||void 0===a)f=e.a.offsetWidth,
  g=n.a.offsetWidth,h=p.a.offsetWidth,u();q=setTimeout(I,50)}}var e=new r(k),n=new r(k),p=new r(k),f=-1,g=-1,h=-1,v=-1,w=-1,x=-1,d=document.createElement("div");d.dir="ltr";t(e,L(c,"sans-serif"));t(n,L(c,"serif"));t(p,L(c,"monospace"));d.appendChild(e.a);d.appendChild(n.a);d.appendChild(p.a);document.body.appendChild(d);v=e.a.offsetWidth;w=n.a.offsetWidth;x=p.a.offsetWidth;I();z(e,function(a){f=a;u()});t(e,L(c,'"'+c.family+'",sans-serif'));z(n,function(a){g=a;u()});t(n,L(c,'"'+c.family+'",serif'));
z(p,function(a){h=a;u()});t(p,L(c,'"'+c.family+'",monospace'))})})};"object"===typeof module?module.exports=A:(window.FontFaceObserver=A,window.FontFaceObserver.prototype.load=A.prototype.load);}());

(function(w) {
  if(w.document.documentElement.className.indexOf("fonts-loaded") <= 0) {
    // Fonts not yet loaded. Wait for them to load, then append the class that
    // will set the loaded font.

    var charterNN = new w.FontFaceObserver("Charter", { weight: "normal", style: "normal" });
    var charterNI = new w.FontFaceObserver("Charter", { weight: "normal", style: "italic" });
    var charterBN = new w.FontFaceObserver("Charter", { weight: "bold", style: "normal" });
    var charterBI = new w.FontFaceObserver("Charter", { weight: "bold", style: "italic" });
    w.Promise.all([
      charterNN.load(null, 3000),
      charterNI.load(null, 3000),
      charterBN.load(null, 3000),
      charterBI.load(null, 3000)
    ]).then(function() {
      w.document.documentElement.className += " fonts-loaded";
      document.cookie="fonts-loaded=true";
    });
  }

  if(w.document.documentElement.className.indexOf("code-fonts-loaded") <= 0) {
    var sourceCodePro400N = new w.FontFaceObserver("Source Code Pro", { weight: "400", style: "normal" });
    var sourceCodePro600N = new w.FontFaceObserver("Source Code Pro", { weight: "600", style: "normal" });
    w.Promise.all([
      sourceCodePro400N.load(null, 3000),
      sourceCodePro600N.load(null, 3000)
    ]).then(function() {
      w.document.documentElement.className += " code-fonts-loaded";
      document.cookie="code-fonts-loaded=true";
    });
  }
}(this));
      </script>
    </body>
</html>
