<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>The End of Dynamic Languages - Elben Shira</title>
        <script>
          function getCookie(cname) {
              var name = cname + "=";
              var ca = document.cookie.split(';');
              for(var i=0; i<ca.length; i++) {
                  var c = ca[i];
                  while (c.charAt(0)==' ') c = c.substring(1);
                  if (c.indexOf(name) == 0) return c.substring(name.length,c.length);
              }
              return "";
          }

          // If cookie set, assume font is cached, so load right away. May get
          // cache miss sometimes (esp w/ GitHub pages 10 min cache), but that's OK.
          if(getCookie("fonts-loaded") == "true") {
              document.documentElement.className += " fonts-loaded";
          }

          if(getCookie("code-fonts-loaded") == "true") {
              document.documentElement.className += " code-fonts-loaded";
          }

          window.addEventListener("load", function() {
            var elems = document.getElementsByClassName("view-comments");
            for (var i = 0; i < elems.length; ++i) {
              elems[i].onclick =
                function () {
                  var disqus = document.getElementById("disqus-comments");
                  if (disqus) {
                    disqus.classList.remove("hide");
                    this.classList.add("hide");
                  }
                }
            }
          });
        </script>

        <link rel="stylesheet" type="text/css" href="/stylesheets/default.css" />
    </head>
    <body>
      <div id="structure">
        <div id="header">
          <h1 itemprop="name"><a href="/">Elben Shira</a></h1>
          <span id="navigation">
            <a href="/blog/">Blog</a>
            <a href="/projects/">Projects</a>
          </span>
          <hr>
        </div>

        <div id="content">
          <article class="post-content">
  <header class="post-header">
    <h1 class="post-title">The End of Dynamic Languages</h1>

    <div class="post-metadata">
      <div class="date">
        November 22, 2015
         / <a href="/blog/tags/recommended/">recommended</a>  / <a href="/blog/tags/programming-languages/">programming-languages</a> 
      </div>
    </div>
  </header>

  
<p>For the past several months, I’ve been programming almost exclusively in Scala (for work) and Haskell (for pleasure). But this week, I was also saturated in Ruby (for work) and Clojure (for pleasure).</p>
<p>Ruby frustrated me at once. Working in Ruby is fine if you’re just <em>adding</em> a feature on top of the pile of features. All you have to do is add some unit tests, make sure the old ones pass, and run away. But anything else is impossibly difficult.</p>
<p>But my brand-new, clean-slate weekend project in Clojure… Ah, Clojure! A breath of fresh air! A land green with libraries rolling in composible functions, immutable data structures, and kind people. How beautiful is your syntax, and how wise are your sensibilities! Your middleware is just a function that takes a map and returns a map. And so is your SQL generator and DB migrator and HTML parser and URL router—a psychedelic circle of maps passed to-and-fro to the beat of the CPU, tick-tocking like a well-tuned Swiss watch.</p>
<p>To be back in Clojure after such a long time away was to feel, instantly, back home. It restored my programmer’s soul.</p>
<p>But then crept in me a peculiar emotion I did not expect: <strong>uncertainty</strong>.</p>
<p>It went something like this:</p>
<blockquote>
<p>Thank you for this immutable <code>request</code> map, O elegant <a href="https://github.com/ring-clojure/ring/">Ring</a>. But may I ask: what exactly is in it?</p>
</blockquote>
<p>— <em>Is it not obvious? It is the HTTP request</em>.</p>
<blockquote>
<p>Yes, of course, but <em>what</em> is that? What are the keys, and what are the values?</p>
</blockquote>
<p>— <em>Is it not obvious? It is the HTTP request</em>.</p>
<blockquote>
<p>Yes, you are right. I will read thy source and seek the truth.</p>
</blockquote>
<p>— <em>Yes, read and understand</em>.</p>
<blockquote>
<p>So I’m reading it all right, but what exactly is this local variable <code>attrs</code>, and <code>f</code>? And when I use <code>wrap-params</code>, what keys are added to my map?</p>
</blockquote>
<p>— <em>Is it not obvious?</em></p>
<blockquote>
<p>Never mind, I’ll just add a <code>println</code> or two.</p>
</blockquote>
<p>This uncertainty wrecks productivity. Every library function you call, unless you have it memorized, requires hunting down the source or test files for examples on how to use it. Every map you get back requires a <code>println</code> to know what it contains.</p>
<p>Yes, Clojure is powerful. But power without support, without someone showing us how to wield that power, can only corrupt. I’m not talking about human philosophy here—just code. Which one of us has not suffered from Ruby’s metaprogramming, or Clojure’s maps? We are both inflictor and victim.</p>
<h3 id="an-example-do-dsls-empower-or-confuse">An example: do DSLs empower or confuse?</h3>
<p>Let’s talk about the corrupting power of Clojure DSLs. Clojurians love DSLs, and Clojure data structures lend itself well to be used in that way.</p>
<p>But I think there is something wrong with this.</p>
<p><a href="https://github.com/weavejester/hiccup">Hiccup</a>, for example, generates HTML. So instead of writing:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">&lt;span</span><span class="ot"> class=</span><span class="st">&quot;foo&quot;</span><span class="kw">&gt;</span>bar<span class="kw">&lt;/span&gt;</span></a></code></pre></div>
<p>You write:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode clojure"><code class="sourceCode clojure"><a class="sourceLine" id="cb2-1" title="1">[<span class="at">:span</span> {<span class="at">:class</span> <span class="st">&quot;foo&quot;</span>} <span class="st">&quot;bar&quot;</span>]</a></code></pre></div>
<p>But HTML is the perfect DSL for writing HTML—why replace it for another DSL with your own set of rules and restrictions, <em>and</em> lose the decades of tooling and know-how of every designer on the face of the planet?</p>
<p>(Thankfully, there is <a href="https://github.com/cgrand/enlive">enlive</a> and <a href="https://github.com/krisajenkins/yesql">yesql</a>).</p>
<p>But a larger problem with using data structures as DSL is that there is no way for me to know if I’m conforming to your DSL until I get a confusing runtime error.</p>
<p>Let’s pick on <a href="https://github.com/juxt/bidi">bidi</a>, a lovely little URL routing library. It’s fun to use, but there is a big, gaping problem with these DSLs.</p>
<p>Say we want to route <code>GET /notes</code>. In bidi, you would define your route like this:</p>
<pre><code>(def my-routes
  [&quot;/notes&quot; :index-handler])</code></pre>
<p>We can test this handler:</p>
<pre><code>(bidi/match-route my-routes &quot;/notes&quot;)
;; {:handler :index-handler}
;; Success!</code></pre>
<p>Easy enough. But what if I want a bunch more routes?</p>
<pre><code>GET  /
GET  /notes
GET  /notes/:id
POST /notes
POST /notes/:id</code></pre>
<p>After several <code>Ctrl-F</code>s in the README, a close reading of the source code, lots of REPL guesswork, and an uncountable number of <code>nil</code>s and exceptions thrown in my face, I find the magic incantation:</p>
<pre><code>(def my-routes
  [&quot;&quot; {&quot;/&quot; :home-page-handler
       &quot;/notes&quot;
         {:get  {&quot;&quot; :index-handler}
          :post {&quot;&quot; :create-handler}
          [&quot;/&quot; :id] {:get  {&quot;&quot; :show-handler}
                     :post {&quot;&quot; :update-handler}}}}])</code></pre>
<p>I’m sure there’s a pattern in there somewhere, but do you see it? Will you remember to type it exactly right, or will you resort to REPLing our routes to death?</p>
<p>I have a feeling that REPL is going to get a <em>lot</em> of use.</p>
<h2 id="the-problem-with-uncertainty">The problem with uncertainty</h2>
<p>Now, don’t get me wrong, negative feelings do arise when writing in typed languages like Haskell and Scala. Confusion, frustration, hopelessness. But uncertainty is perhaps worse than all the others. You can resolve all the others by sitting down and learning the thing. But how does one resolve <em>uncertainty</em>? Only with more certainty. But what if the language does not provide a way to make certain of the uncertain?</p>
<p>Let’s examine some current attempts.</p>
<h3 id="gradual-typing">Gradual typing</h3>
<p>There is a frantic rush to bolt-on a type system to every dynamic language out there. Typed Racket, Typed Clojure, TypeScript, Typed Lua. Even Python has “type hints”.</p>
<p>This is a good thing, and a long time coming. It shows that people are hungry for certainty.</p>
<p>Unfortunately I have a suspicion that gradual typing won’t be enough. First, it requires a lot of energy to type all the libraries. Can the Clojure community be disciplined enough to add the required annotations in a majority of libraries? How many Clojure libraries provide <code>core.typed</code> annotations today?</p>
<p>Currently, I do not see such an effort succeeding.</p>
<p>We can strive for a culture of care and ownership, and we can demand for one until we are blue in the face (you know when your PR comments turn more snippy than helpful). But why is it so hard?</p>
<p>The fundamental problem, you see, is that a programming language is not just about code. Implied in the community is a school of thought, a philosophy. And <em>that</em> is difficult to change.</p>
<h3 id="it-is-not-enough">It is not enough</h3>
<p>What about unit tests, property tests, linters, runtime contracts, pair programming and PR reviews? What a plethora of tools! Surely they are sufficient.</p>
<p>I’m afraid they are not. Unit and property tests are of most value when they test functionality, not when they are used to test whether or not the shape of the result conforms to your expectation. Runtime contracts can diverge from the actual intent and are still runtime problems, and pair programming and PRs still have the fallible human in the picture.</p>
<p>Linters for dynamic languages are crippled to the point of being more about vanity and less about quality. If your argument for using your linter is that it finds whitespace issues, I’m not sure that’s solving important problems.</p>
<p>Using Haskell’s <code>hlint</code>, however, is like programming in the future. Because Haskell is a typed language, the linter knows a lot more about your program than just syntax. It can find <em>structural</em> problems too, like:</p>
<ul>
<li>When two equivalent anonymous functions that can be extracted out</li>
<li>When a library method already exists for an expression</li>
<li>When you fail to match every possible result in a case statement</li>
</ul>
<p>We talk about strong AI. What if we start with tools that help us prevent runtime mistakes and guide us to write better code.</p>
<p>Does that sound like something you want?</p>
<h2 id="a-short-story">A short story</h2>
<p>OK, enough ranting. Let’s pause. Here is a story of how we used our <em>programming language</em> to help us eradicate a certain class of bugs from a production code base.</p>
<p>Last week, I was frustrated at a particular Scala code base because it was so easy to write bugs that wrote wrong values into a Solr search cluster. For example, Solr silently allows <code>null</code> to be written to a boolean field. I spent a week refactoring that messy, bug-prone monolith into small, composible chunks that passed around immutable data structures ala Clojure. At first I thought it was great work. The new code was nice-to-read and well-tested. Yet I found myself writing the same runtime bugs I was writing before. One even involved breaking our porn filter (quick, what do you do when <code>isItPorn</code> returns <code>null</code>?).</p>
<p>So my co-worker Adam and I set a goal: <strong>turn all these runtime bugs into compiler errors.</strong> We wanted a big, fat FAILED TO COMPILE message if we tried to insert <code>null</code> into a boolean field.</p>
<p>It took us two days to figure out how to wrangle the Scala type system to do what we wanted. We almost pulled in <a href="https://github.com/milessabin/shapeless">shapeless</a> (conjecture: all Scala programmers converge to shapeless).</p>
<p>But then we found a simpler system that worked. We could convert all of our old runtime errors into type errors. Adam refactored the entire code base to use our new design in just a few hours.</p>
<p>Today, I updated one of my client projects to use this refactored library. <span style="border-bottom: 2px dotted #ff0000;">A red line appeared</span>. It was a bug, caught by the compiler, never noticed until now.</p>
<p>Such power will never be available in a language like Ruby, and likely not Clojure either. But such power does exist. And you can have it too.</p>
<p>Let’s be clear: I am not suggesting that you and your team will start writing better, more-certain code the day you move away from Ruby. In fact, there will be a noticable dip in productivity and a noticable rise in audible profanity. But that is a growing pain, and it is only expected when learning anything new. What we should look forward to, however, is the inevitable improvement and confidence to come.</p>
<h2 id="the-end-of-an-era">The end of an era</h2>
<p>This is my bet: <strong>the age of dynamic languages is over</strong>. There will be no new successful ones. Indeed we have learned a lot from them. We’ve learned that library code should be extendable by the programmer (mixins and meta-programming), that we want to control the structure (macros), that we disdain verbosity. And above all, we’ve learned that we want our languages to be enjoyable.</p>
<p>But it’s time to move on. We will see a flourishing of languages that <em>feel</em> like you’re writing in a Clojure, but typed. Included will be a suite of powerful tools that we’ve never seen before, tools so convincing that only ascetics will ignore.</p>
<p>To do this, we need to feed our tools the information they need to help us; a psychologist cannot help the silent patient. We begin by adding types, by restricting the space of possibilities to free ourselves from the self-made burden of uncertainty. New languages like Elm and Crystal are on the right track, and of course established ones like Haskell and Scala. We need more languages like these.</p>
<p>We think we have seen everything under the sun, that there are no new ideas worth learning. Worse yet, we refuse to learn anything unfamiliar. (Yuck, look at that syntax!) But remember how <em>hard</em> it was when we first learned to code? Was it not worth the effort? We should not be afraid to embark on that familiar journey once again.</p>
<p>The Christian theologian Gerhardus Vos described the tension of this life as “already but not yet.” That is, a Christian is at once made into a new creation by their faith, but at the same time still carries the burdens and sorrows of this life.</p>
<p>What an apt description of where we are today. From a distance, we can envision what productive, empowering and confident languages would look and feel like. Many that exist today is on its way, but we are not there yet. Surely we can do better.</p>
</article>

<div class="post-content-end">
  <hr>

  <div class="view-comments">
    <a>View comments</a>
  </div>

  <div id="disqus-comments" class="hide">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname = 'elbenshira';
      var disqus_category_id = '2658740'; // "Blog" category.

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
         var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
         dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
         (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
       })();
    </script>
    <noscript>Enable JavaScript to view Disqus comments.</noscript>
  </div>

</div>

        </div>
      </div>

      <script>
        /* Font Face Observer v2.0.13 - © Bram Stein. License: BSD-3-Clause https://raw.githubusercontent.com/bramstein/fontfaceobserver */
        (function(){'use strict';var f,g=[];function l(a){g.push(a);1==g.length&&f()}function m(){for(;g.length;)g[0](),g.shift()}f=function(){setTimeout(m)};function n(a){this.a=p;this.b=void 0;this.f=[];var b=this;try{a(function(a){q(b,a)},function(a){r(b,a)})}catch(c){r(b,c)}}var p=2;function t(a){return new n(function(b,c){c(a)})}function u(a){return new n(function(b){b(a)})}function q(a,b){if(a.a==p){if(b==a)throw new TypeError;var c=!1;try{var d=b&&b.then;if(null!=b&&"object"==typeof b&&"function"==typeof d){d.call(b,function(b){c||q(a,b);c=!0},function(b){c||r(a,b);c=!0});return}}catch(e){c||r(a,e);return}a.a=0;a.b=b;v(a)}}
function r(a,b){if(a.a==p){if(b==a)throw new TypeError;a.a=1;a.b=b;v(a)}}function v(a){l(function(){if(a.a!=p)for(;a.f.length;){var b=a.f.shift(),c=b[0],d=b[1],e=b[2],b=b[3];try{0==a.a?"function"==typeof c?e(c.call(void 0,a.b)):e(a.b):1==a.a&&("function"==typeof d?e(d.call(void 0,a.b)):b(a.b))}catch(h){b(h)}}})}n.prototype.g=function(a){return this.c(void 0,a)};n.prototype.c=function(a,b){var c=this;return new n(function(d,e){c.f.push([a,b,d,e]);v(c)})};
function w(a){return new n(function(b,c){function d(c){return function(d){h[c]=d;e+=1;e==a.length&&b(h)}}var e=0,h=[];0==a.length&&b(h);for(var k=0;k<a.length;k+=1)u(a[k]).c(d(k),c)})}function x(a){return new n(function(b,c){for(var d=0;d<a.length;d+=1)u(a[d]).c(b,c)})};window.Promise||(window.Promise=n,window.Promise.resolve=u,window.Promise.reject=t,window.Promise.race=x,window.Promise.all=w,window.Promise.prototype.then=n.prototype.c,window.Promise.prototype["catch"]=n.prototype.g);}());

             (function(){function l(a,b){document.addEventListener?a.addEventListener("scroll",b,!1):a.attachEvent("scroll",b)}function m(a){document.body?a():document.addEventListener?document.addEventListener("DOMContentLoaded",function c(){document.removeEventListener("DOMContentLoaded",c);a()}):document.attachEvent("onreadystatechange",function k(){if("interactive"==document.readyState||"complete"==document.readyState)document.detachEvent("onreadystatechange",k),a()})};function r(a){this.a=document.createElement("div");this.a.setAttribute("aria-hidden","true");this.a.appendChild(document.createTextNode(a));this.b=document.createElement("span");this.c=document.createElement("span");this.h=document.createElement("span");this.f=document.createElement("span");this.g=-1;this.b.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;";this.c.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;";
             this.f.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;";this.h.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;";this.b.appendChild(this.h);this.c.appendChild(this.f);this.a.appendChild(this.b);this.a.appendChild(this.c)}
             function t(a,b){a.a.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;white-space:nowrap;font-synthesis:none;font:"+b+";"}function y(a){var b=a.a.offsetWidth,c=b+100;a.f.style.width=c+"px";a.c.scrollLeft=c;a.b.scrollLeft=a.b.scrollWidth+100;return a.g!==b?(a.g=b,!0):!1}function z(a,b){function c(){var a=k;y(a)&&a.a.parentNode&&b(a.g)}var k=a;l(a.b,c);l(a.c,c);y(a)};function A(a,b){var c=b||{};this.family=a;this.style=c.style||"normal";this.weight=c.weight||"normal";this.stretch=c.stretch||"normal"}var B=null,C=null,E=null,F=null;function G(){if(null===C)if(J()&&/Apple/.test(window.navigator.vendor)){var a=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))(?:\.([0-9]+))/.exec(window.navigator.userAgent);C=!!a&&603>parseInt(a[1],10)}else C=!1;return C}function J(){null===F&&(F=!!document.fonts);return F}
function K(){if(null===E){var a=document.createElement("div");try{a.style.font="condensed 100px sans-serif"}catch(b){}E=""!==a.style.font}return E}function L(a,b){return[a.style,a.weight,K()?a.stretch:"","100px",b].join(" ")}
A.prototype.load=function(a,b){var c=this,k=a||"BESbswy",q=0,D=b||3E3,H=(new Date).getTime();return new Promise(function(a,b){if(J()&&!G()){var M=new Promise(function(a,b){function e(){(new Date).getTime()-H>=D?b():document.fonts.load(L(c,'"'+c.family+'"'),k).then(function(c){1<=c.length?a():setTimeout(e,25)},function(){b()})}e()}),N=new Promise(function(a,c){q=setTimeout(c,D)});Promise.race([N,M]).then(function(){clearTimeout(q);a(c)},function(){b(c)})}else m(function(){function u(){var b;if(b=-1!=
  f&&-1!=g||-1!=f&&-1!=h||-1!=g&&-1!=h)(b=f!=g&&f!=h&&g!=h)||(null===B&&(b=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),B=!!b&&(536>parseInt(b[1],10)||536===parseInt(b[1],10)&&11>=parseInt(b[2],10))),b=B&&(f==v&&g==v&&h==v||f==w&&g==w&&h==w||f==x&&g==x&&h==x)),b=!b;b&&(d.parentNode&&d.parentNode.removeChild(d),clearTimeout(q),a(c))}function I(){if((new Date).getTime()-H>=D)d.parentNode&&d.parentNode.removeChild(d),b(c);else{var a=document.hidden;if(!0===a||void 0===a)f=e.a.offsetWidth,
  g=n.a.offsetWidth,h=p.a.offsetWidth,u();q=setTimeout(I,50)}}var e=new r(k),n=new r(k),p=new r(k),f=-1,g=-1,h=-1,v=-1,w=-1,x=-1,d=document.createElement("div");d.dir="ltr";t(e,L(c,"sans-serif"));t(n,L(c,"serif"));t(p,L(c,"monospace"));d.appendChild(e.a);d.appendChild(n.a);d.appendChild(p.a);document.body.appendChild(d);v=e.a.offsetWidth;w=n.a.offsetWidth;x=p.a.offsetWidth;I();z(e,function(a){f=a;u()});t(e,L(c,'"'+c.family+'",sans-serif'));z(n,function(a){g=a;u()});t(n,L(c,'"'+c.family+'",serif'));
z(p,function(a){h=a;u()});t(p,L(c,'"'+c.family+'",monospace'))})})};"object"===typeof module?module.exports=A:(window.FontFaceObserver=A,window.FontFaceObserver.prototype.load=A.prototype.load);}());

(function(w) {
  if(w.document.documentElement.className.indexOf("fonts-loaded") <= 0) {
    // Fonts not yet loaded. Wait for them to load, then append the class that
    // will set the loaded font.

    var charterNN = new w.FontFaceObserver("Charter", { weight: "normal", style: "normal" });
    var charterNI = new w.FontFaceObserver("Charter", { weight: "normal", style: "italic" });
    var charterBN = new w.FontFaceObserver("Charter", { weight: "bold", style: "normal" });
    var charterBI = new w.FontFaceObserver("Charter", { weight: "bold", style: "italic" });
    w.Promise.all([
      charterNN.load(null, 3000),
      charterNI.load(null, 3000),
      charterBN.load(null, 3000),
      charterBI.load(null, 3000)
    ]).then(function() {
      w.document.documentElement.className += " fonts-loaded";
      document.cookie="fonts-loaded=true";
    });
  }

  if(w.document.documentElement.className.indexOf("code-fonts-loaded") <= 0) {
    var sourceCodePro400N = new w.FontFaceObserver("Source Code Pro", { weight: "400", style: "normal" });
    var sourceCodePro600N = new w.FontFaceObserver("Source Code Pro", { weight: "600", style: "normal" });
    w.Promise.all([
      sourceCodePro400N.load(null, 3000),
      sourceCodePro600N.load(null, 3000)
    ]).then(function() {
      w.document.documentElement.className += " code-fonts-loaded";
      document.cookie="code-fonts-loaded=true";
    });
  }
}(this));
      </script>
    </body>
</html>
